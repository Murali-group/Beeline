

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BoolODE.model_generator &mdash; BEELINE  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> BEELINE
          

          
            
            <img src="../../_static/beeline.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../BEELINE.html">BEELINE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../BoolODE-intro.html">BoolODE</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BEELINE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../BoolODE.html">BoolODE</a> &raquo;</li>
        
      <li>BoolODE.model_generator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for BoolODE.model_generator</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Amogh Jalihal&#39;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="k">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="k">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="c1"># local imports</span>
<span class="kn">from</span> <span class="nn">BoolODE</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">BoolODE</span> <span class="k">import</span> <span class="n">simulator</span> 
<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="k">import</span> <span class="n">SourceFileLoader</span>

<div class="viewcode-block" id="GenerateModel"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel">[docs]</a><span class="k">class</span> <span class="nc">GenerateModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class that holds model attributes. Provides helper functions to convert a Boolean model</span>
<span class="sd">    to an ODE model</span>
<span class="sd">    </span>
<span class="sd">    :param settings: User defined job settings. This is created in boolode.do_post_processing()</span>
<span class="sd">    :type settings: dict</span>
<span class="sd">    :param parameterInputsDF: User specified parmeter inputs. Specified in config YAML as a path.</span>
<span class="sd">    :type parameterInputsDF: pandas DataFrame</span>
<span class="sd">    :param parameterSetDF: User specified kinetic parameters. Specified in config YAML as a path.</span>
<span class="sd">    :type parameterSetDF: pandas DataFrame</span>
<span class="sd">    :param interactionStrengthDF: User specified interaction strengths. Specified in config YAML as a path</span>
<span class="sd">    :type interactionStrengthDF: pandas DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">parameterInputsDF</span><span class="p">,</span> <span class="n">parameterSetDF</span><span class="p">,</span> <span class="n">interactionStrengthDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class is initialized with the job_settings dictionary created </span>
<span class="sd">        by the BoolODE class. Additionally, three dataframe objects are required:</span>

<span class="sd">        1. parameterInputsDF - specifies parameter inputs</span>
<span class="sd">        2. parameterSetDF - specifies pregenerated python file containing kinetic parameter values</span>
<span class="sd">        3. interactionStrengthDF - specifies interactions strengths</span>

<span class="sd">        By default, if these aren&#39;t specified by the user, BoolODE stores empty pandas DataFrame objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span> <span class="o">=</span> <span class="n">parameterInputsDF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterSetDF</span> <span class="o">=</span> <span class="n">parameterSetDF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span> <span class="o">=</span> <span class="n">interactionStrengthDF</span>
        <span class="c1"># Class variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">withoutRules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allnodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parmapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteinlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeTypeDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_ode_model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span>
        <span class="c1"># Read the model definition</span>
        <span class="c1"># 1. populate self.df</span>
        <span class="c1"># 2. store genelist, withRules, withoutRules, allnodes</span>
        <span class="c1"># 3. initialize varspecs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readBooleanRules</span><span class="p">()</span>
        <span class="c1"># Create model parameters and assign values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getParameters</span><span class="p">()</span>
        <span class="c1"># Create the model dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateModelDict</span><span class="p">()</span>
        <span class="c1"># Write ODE model to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeModelToFile</span><span class="p">()</span>
        <span class="c1"># Write parameters to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeParametersToFile</span><span class="p">()</span>
        
<div class="viewcode-block" id="GenerateModel.readBooleanRules"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.readBooleanRules">[docs]</a>    <span class="k">def</span> <span class="nf">readBooleanRules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a rule file from path and stores the rules in a dictionary.</span>
<span class="sd">        Performs the following transformations:</span>

<span class="sd">        1. Parses each Boolean rule to extract nodes in the model</span>
<span class="sd">        2. Identifies nodes without corresponding rules: (a) If a parameterInput file is specified and the node under consideration</span>
<span class="sd">           is present in the file, the node is treated as an input parameter</span>
<span class="sd">           (b) Else, a self-edge is added to the node</span>
<span class="sd">        3. Adds dummy genes - *This is experimental*</span>
<span class="sd">        4. Finally, create a gene (x\_) and protein (p\_)  variable corresponding to </span>
<span class="sd">           each node in the network, taking into consideration user defined types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modelpath&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1">## Extract all nodes from the boolean rules</span>
        <span class="c1">## Note that not all nodes might have a rule attached to them</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rule&#39;</span><span class="p">]</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;not&#39;</span><span class="p">,</span><span class="s1">&#39;and&#39;</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allnodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">reg</span><span class="p">))</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">withoutRules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allnodes</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">)))</span>

        <span class="c1">## Every node without a rule is treated as follows:</span>
        <span class="c1">## If the user has specified a Parameter Input file treat as parameter, else </span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withoutRules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span><span class="o">.</span><span class="n">empty</span>\
               <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Treating </span><span class="si">%s</span><span class="s2"> as parameter&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="n">n</span><span class="p">})</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;has no rule, adding self-activation.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Gene&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="s1">&#39;Rule&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">withoutRules</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;add_dummy&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addDummyGenes</span><span class="p">()</span>
        
        <span class="c1"># Variables:</span>
        <span class="c1">## Check:</span>
        <span class="c1">## If nodeType is provided, initialize the</span>
        <span class="c1">## correct node names.</span>
        <span class="c1">## Rule:</span>
        <span class="c1">## Every gene (x_node) gets a corresponding</span>
        <span class="c1">## protein (p_node). The gene equation contains</span>
        <span class="c1">## regulatory logic, protein equation contains production</span>
        <span class="c1">## degradation terms.</span>
        <span class="c1">## Every &#39;protein&#39; (p_node) only gets one variable,</span>
        <span class="c1">## and the corresponding equation contains the regulatory</span>
        <span class="c1">## logic term. There is no production/degradation associated</span>
        <span class="c1">## with this node.</span>

        <span class="c1"># Create empty equations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeTypeDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Assume everything is a gene, so make the corresponding protein</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="p">[</span><span class="s1">&#39;x_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="p">[</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO Consider removing support for node type.</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeTypeDF</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;protein&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proteinlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gene&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;x_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">],</span><span class="s2">&quot;not recognized. Treating as gene.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;x_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="GenerateModel.addDummyGenes"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.addDummyGenes">[docs]</a>    <span class="k">def</span> <span class="nf">addDummyGenes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add dummy genes. </span>
<span class="sd">        Starts with the user specified Boolean model, and grows the</span>
<span class="sd">        network by adding new &#39;dummy&#39; nodes to each existing node.</span>
<span class="sd">        In the current configuration, the user can specify `max_parents`</span>
<span class="sd">        which specifies the number of parent nodes of every dummy node.</span>
<span class="sd">        Currently, twice as many dummy nodes as nodes in the original graph</span>
<span class="sd">        are added. </span>

<span class="sd">        .. todo::</span>
<span class="sd">            Expand this function by adding user defined number of nodes.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This feature is experimental.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using max_parents=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;max_parents&#39;</span><span class="p">]))</span>
        <span class="n">num_dummy</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">allnodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dummy</span><span class="p">):</span>
            <span class="c1">## Variable number of parents</span>
            <span class="c1"># DF = DF.append({&#39;Gene&#39;:&#39;dummy&#39; + str(dg),</span>
            <span class="c1">#                 &#39;Rule&#39;:&#39; or &#39;.join([s for s in \</span>
            <span class="c1">#                                     np.random.choice(list(allnodes),</span>
            <span class="c1">#                                                      size=np.random.choice([i+1 for i in range(len(allnodes)-1)]))])},</span>
            <span class="c1">#                ignore_index = True)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Gene&#39;</span><span class="p">:</span><span class="s1">&#39;dummy&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dg</span><span class="p">),</span>
                                      <span class="s1">&#39;Rule&#39;</span><span class="p">:</span><span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> \
                                                          <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">allnodes</span><span class="p">),</span>
                                                                           <span class="n">size</span><span class="o">=</span><span class="n">max_parents</span><span class="p">)])},</span>
                                     <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s1">&#39;outPrefix&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;rules-with-added-genes.csv&#39;</span><span class="p">)</span>        </div>
        
<div class="viewcode-block" id="GenerateModel.getParameters"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.getParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and assigns the kinetic parameters for each equations the</span>
<span class="sd">        corresponding parameter value.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Default kinetic parameter values are stored in ./parameters.yaml. This</span>
<span class="sd">            is provided to make it easy for users to define different defaults, but it </span>
<span class="sd">            other parameter values have not been tested extensively, and might not</span>
<span class="sd">            yield the expected results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">loadParameterValues</span><span class="p">()</span>
        
        <span class="c1">## Derived parameters:</span>
        <span class="c1">## The threshold is calculated as the half max value of the species</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;mRNATranscription&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;mRNADegradation&#39;</span><span class="p">]</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">x_max</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;proteinTranslation&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;proteinDegradation&#39;</span><span class="p">])</span>
        
        <span class="n">hillThreshold</span> <span class="o">=</span> <span class="n">y_max</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">heavisideOmega</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="n">y_max</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;x_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;y_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;hillThreshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hillThreshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;heavisideOmega&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heavisideOmega</span>        
    
        <span class="n">parameterNamePrefixAndDefaultsAll</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Hill coefficients</span>
            <span class="s1">&#39;n_&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;hillCoefficient&#39;</span><span class="p">],</span>
            <span class="c1"># Thresholds</span>
            <span class="s1">&#39;k_&#39;</span><span class="p">:</span><span class="n">hillThreshold</span><span class="p">,</span>
            <span class="c1"># Soft-Heaviside function steepness</span>
            <span class="s1">&#39;sigmaH_&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;heavisideSigma&#39;</span><span class="p">]</span>
        <span class="p">}</span>     
        <span class="n">parameterNamePrefixAndDefaultsGenes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># mRNA transcription rates</span>
            <span class="s1">&#39;m_&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;mRNATranscription&#39;</span><span class="p">],</span>
            <span class="c1"># mRNA degradation rates</span>
            <span class="s1">&#39;l_x_&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;mRNADegradation&#39;</span><span class="p">],</span>
            <span class="c1"># Protein translation rate</span>
            <span class="s1">&#39;r_&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;proteinTranslation&#39;</span><span class="p">],</span>
            <span class="c1"># protein degradation rates</span>
            <span class="s1">&#39;l_p_&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;proteinDegradation&#39;</span><span class="p">]</span>
        <span class="p">}</span>     
        
        <span class="n">par</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1">## If there is even one signaling protein,</span>
        <span class="c1">## create the y_max parameter</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteinlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;y_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_max</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;signalingtimescale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">signalingtimescale</span>
            
        <span class="n">interactionStrengths</span> <span class="o">=</span> <span class="p">{}</span>
    
        <span class="c1">## Carry out a series of checks to handle user defined input to model</span>

        <span class="c1">## Check 1: handle &quot;input parameters&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># TODO The name &#39;parameter inputs&#39; is confusing/misleading, considering renaming?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addParameterInputs</span><span class="p">()</span>

        <span class="c1">## Check 2: include user-specified interaction strengths</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addInteractionStrengths</span><span class="p">(</span><span class="n">hillThreshold</span><span class="p">)</span>

        <span class="c1">## Assigining values to each kinetic parameter</span>
        <span class="c1">## Create a parameter of each parameter type for each gene.</span>
        <span class="c1">## If samplePars=True, sample values from normal distributions,</span>
        <span class="c1">## else, set all parameters to defaults</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;sample_pars&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignSampledParameterValues</span><span class="p">(</span><span class="n">parameterNamePrefixAndDefaultsAll</span><span class="p">,</span>
                                     <span class="n">parameterNamePrefixAndDefaultsGenes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignDefaultParameterValues</span><span class="p">(</span><span class="n">parameterNamePrefixAndDefaultsAll</span><span class="p">,</span>
                                     <span class="n">parameterNamePrefixAndDefaultsGenes</span><span class="p">)</span>

        <span class="c1"># Final check:</span>
        <span class="c1"># Update user defined parameter values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterSetDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pname</span><span class="p">,</span> <span class="n">pval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterSetDF</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvalue</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>
                
<div class="viewcode-block" id="GenerateModel.addParameterInputs"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.addParameterInputs">[docs]</a>    <span class="k">def</span> <span class="nf">addParameterInputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check for user specified input parameters.</span>
<span class="sd">        If a parameter input file is specified,</span>
<span class="sd">        Every row in parameterInputsDF contains two</span>
<span class="sd">        columns:</span>

<span class="sd">        1. &#39;Input&#39; specifies the name of input parameter</span>
<span class="sd">        2. &#39;Value&#39; specified the input state, typically 1 or 0, but for HIGH and LOW inputs respectively, but any float between 0 and 1 is valid input.</span>
<span class="sd">          </span>
<span class="sd">        Now, we create a fake hill term for this input, even</span>
<span class="sd">        though there is no equation corresponding to it. Thus,</span>
<span class="sd">        we create a hillThreshold and hillCoefficient </span>
<span class="sd">        term for it. This is useful so we can treat this input</span>
<span class="sd">        parameter as a &quot;regulator&quot; and leave the structure of</span>
<span class="sd">        the logic term unchanged.</span>

<span class="sd">        .. todo::</span>
<span class="sd">            Add appropriate parameters if heaviside</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameterInputsDict</span>  <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hillThreshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;hillThreshold&#39;</span><span class="p">]</span>
        <span class="n">hillCoefficient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;hillCoefficient&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># initialize</span>
            <span class="c1">#parameterInputsDict[i] = {p:0 for p in self.withoutRules} ## Suspicious</span>
            <span class="n">inputParam</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]</span>            
            <span class="k">if</span> <span class="n">inputParam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withoutRules</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">inputParam</span><span class="p">,</span> <span class="s2">&quot;not found nodes without rules. Skipping&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1">## This can take values between 0 and 1</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">inputValue</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">inputValue</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inputValue</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
                <span class="c1"># The following line sets the appropriate constant input</span>
                <span class="c1"># Note: 2*hillThreshold is the max value that a protein can take</span>
                <span class="n">parameterInputsDict</span><span class="p">[</span><span class="n">inputParam</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputValue</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">hillThreshold</span>
        <span class="c1"># Add input parameters, set to the value calculated above</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameterInputsDict</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;k_&#39;</span><span class="o">+</span><span class="n">p</span><span class="p">:</span><span class="n">hillThreshold</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameterInputsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;n_&#39;</span><span class="o">+</span><span class="n">p</span><span class="p">:</span><span class="n">hillCoefficient</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameterInputsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()})</span></div>

<div class="viewcode-block" id="GenerateModel.addInteractionStrengths"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.addInteractionStrengths">[docs]</a>    <span class="k">def</span> <span class="nf">addInteractionStrengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hillThreshold</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if interaction strengths are specified.</span>
<span class="sd">        Create a new parameter specifying the strength</span>
<span class="sd">        of a given interaction. For all other equations in</span>
<span class="sd">        which &quot;regulator&quot; appears in, its hillThreshold value</span>
<span class="sd">        will remain the default value.</span>

<span class="sd">        .. todo::</span>
<span class="sd">            Add appropriate parameters if heaviside</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">regulator</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Gene2&#39;</span><span class="p">]</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Gene1&#39;</span><span class="p">]</span>
            <span class="n">interactionStrength</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Strength&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;k_&#39;</span> <span class="o">+</span> <span class="n">regulator</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">target</span><span class="p">:</span> <span class="n">hillThreshold</span><span class="o">/</span><span class="n">interactionStrength</span><span class="p">})</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;w_&#39;</span> <span class="o">+</span> <span class="n">regulator</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">target</span><span class="p">:</span> <span class="n">hillThreshold</span><span class="o">/</span><span class="n">interactionStrength</span><span class="p">})</span></div>
        

<div class="viewcode-block" id="GenerateModel.assignDefaultParameterValues"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.assignDefaultParameterValues">[docs]</a>    <span class="k">def</span> <span class="nf">assignDefaultParameterValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">parameterNamePrefixAndDefaultsAll</span><span class="p">,</span>
                                     <span class="n">parameterNamePrefixAndDefaultsGenes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set each kinetic parameter to its default value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fixing rate parameters to defaults&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">parPrefix</span><span class="p">,</span> <span class="n">parDefault</span> <span class="ow">in</span> <span class="n">parameterNamePrefixAndDefaultsAll</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="n">parPrefix</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">parDefault</span>
                
        <span class="k">for</span> <span class="n">parPrefix</span><span class="p">,</span> <span class="n">parDefault</span> <span class="ow">in</span> <span class="n">parameterNamePrefixAndDefaultsGenes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="n">parPrefix</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">parDefault</span></div>

<div class="viewcode-block" id="GenerateModel.assignSampledParameterValues"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.assignSampledParameterValues">[docs]</a>    <span class="k">def</span> <span class="nf">assignSampledParameterValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">parameterNamePrefixAndDefaultsAll</span><span class="p">,</span>
                                     <span class="n">parameterNamePrefixAndDefaultsGenes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Sample kinetic parameters from a truncated normal distribution with mean=default</span>
<span class="sd">        parameter value, and standard deviation = sample_std, in a range +- 10% of </span>
<span class="sd">        the default value. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampling parameter values&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using std=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;sample_std&#39;</span><span class="p">]))</span>
        <span class="n">lomult</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="n">himult</span> <span class="o">=</span> <span class="mf">1.1</span>

        <span class="k">for</span> <span class="n">parPrefix</span><span class="p">,</span> <span class="n">parDefault</span> <span class="ow">in</span> <span class="n">parameterNamePrefixAndDefaultsAll</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sampledParameterValues</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getSaneNval</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">),</span>\
                                                 <span class="n">lo</span><span class="o">=</span><span class="n">lomult</span><span class="o">*</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">hi</span><span class="o">=</span><span class="n">himult</span><span class="o">*</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">mu</span><span class="o">=</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">sig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;sample_std&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">identicalPars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;identical_pars&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">sparval</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">,</span> <span class="n">sampledParameterValues</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="n">parPrefix</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">sparval</span>
                    
        <span class="k">for</span> <span class="n">parPrefix</span><span class="p">,</span> <span class="n">parDefault</span> <span class="ow">in</span> <span class="n">parameterNamePrefixAndDefaultsGenes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sampledParameterValues</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getSaneNval</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">),</span>\
                                                 <span class="n">lo</span><span class="o">=</span><span class="n">lomult</span><span class="o">*</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">hi</span><span class="o">=</span><span class="n">himult</span><span class="o">*</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">mu</span><span class="o">=</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">sig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;sample_std&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">parDefault</span><span class="p">,</span>\
                                                 <span class="n">identicalPars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;identical_pars&#39;</span><span class="p">])</span>
            
            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">sparval</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">,</span> <span class="n">sampledParameterValues</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="n">parPrefix</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">sparval</span></div>

<div class="viewcode-block" id="GenerateModel.createRegulatoryTerms"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.createRegulatoryTerms">[docs]</a>    <span class="k">def</span> <span class="nf">createRegulatoryTerms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currgene</span><span class="p">,</span> <span class="n">combinationOfRegulators</span><span class="p">,</span>
                              <span class="n">regSpecies</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the terms in the activation function which governs</span>
<span class="sd">        the transcriptional state of the gene. </span>
<span class="sd">        If modeltype is &#39;hill&#39;, each term is composed of products of Hill functions, ranging over</span>
<span class="sd">        all possible combinations of regulators. </span>
<span class="sd">        Similarly, if modeltype is &#39;heaviside&#39;, each term is simply a</span>
<span class="sd">        product of the activities of the combinations of regulators, for all combinations.</span>
<span class="sd">        Here, the form of a single term is generated for a single combination of regulators.</span>
<span class="sd">        </span>
<span class="sd">        :param currgene: Name of the current gene</span>
<span class="sd">        :type currgene: str</span>
<span class="sd">        :param combinationOfRegulators: a list of all combinations of regulators of currgene</span>
<span class="sd">        :type combinationOfRegulators: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strengthSpecified</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currgene</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span><span class="p">[</span><span class="s1">&#39;Gene1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">strengthSpecified</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">regulatorsWithStrength</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span><span class="p">[</span>\
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">interactionStrengthDF</span><span class="p">[</span><span class="s1">&#39;Gene1&#39;</span><span class="p">]</span>\
                                                                        <span class="o">==</span> <span class="n">currgene</span><span class="p">][</span><span class="s1">&#39;Gene2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
            <span class="c1"># Create the hill function terms for each regulator</span>
            <span class="n">hills</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">combinationOfRegulators</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">strengthSpecified</span> <span class="ow">and</span> <span class="p">(</span><span class="n">reg</span> <span class="ow">in</span> <span class="n">regulatorsWithStrength</span><span class="p">):</span>
                    <span class="n">hillThresholdName</span> <span class="o">=</span> <span class="s1">&#39;k_&#39;</span> <span class="o">+</span> <span class="n">reg</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">currgene</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hillThresholdName</span> <span class="o">=</span> <span class="s1">&#39;k_&#39;</span> <span class="o">+</span> <span class="n">reg</span>

                <span class="k">if</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regSpecies</span><span class="p">:</span>
                    <span class="n">hills</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(p_&#39;</span><span class="o">+</span> <span class="n">reg</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">hillThresholdName</span><span class="o">+</span><span class="s1">&#39;)^n_&#39;</span><span class="o">+</span> <span class="n">reg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Note: Only proteins can be regulators</span>
                    <span class="n">hills</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span> <span class="n">reg</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">hillThresholdName</span><span class="o">+</span><span class="s1">&#39;)^n_&#39;</span><span class="o">+</span> <span class="n">reg</span><span class="p">)</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hills</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mult</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">combinationOfRegulators</span><span class="p">:</span>
                <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">reg</span><span class="p">)</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mult</span>        </div>
                    
<div class="viewcode-block" id="GenerateModel.generateModelDict"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.generateModelDict">[docs]</a>    <span class="k">def</span> <span class="nf">generateModelDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a DataFrame object with Boolean rules,</span>
<span class="sd">        construct ODE equations for each variable.</span>
<span class="sd">        This is the core function in BoolODE.</span>
<span class="sd">        In a nutshell, a temporary namespace called boolodespace</span>
<span class="sd">        is created. In this namespace, the nodes  in the Boolean network</span>
<span class="sd">        are first initialized to 0, or OFF. Then, for each gene/node,</span>
<span class="sd">        its corresponding rule is evaluated by setting its regulators to</span>
<span class="sd">        all combinations binary states. The outcome of each of these Boolean</span>
<span class="sd">        rule evaluations is used to decide the value of the activation strength</span>
<span class="sd">        parameter &#39;a&#39; in Hill functions, or the interaction parameter &#39;w&#39; in </span>
<span class="sd">        the Heaviside functions. </span>
<span class="sd">        Each step of this conversion is documented in the code directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
                    
        <span class="c1">##########################################################</span>
        <span class="c1">## Assign values to alpha parameters representing the logic</span>
        <span class="c1">## relationships between variables</span>
        <span class="c1"># Initialize new namespace</span>
        <span class="n">boolodespace</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Initialize empty equations</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">:</span>
            <span class="c1"># Initialize species to 0</span>
            <span class="n">tempStr</span> <span class="o">=</span> <span class="n">node</span> <span class="o">+</span> <span class="s2">&quot; = 0&quot;</span>  
            <span class="n">exec</span><span class="p">(</span><span class="n">tempStr</span><span class="p">,</span> <span class="n">boolodespace</span><span class="p">)</span>

        <span class="c1"># If there is no rule correspondng to a node, it is either</span>
        <span class="c1"># a user specified parameter input, or it is assigned a self loop.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">withoutRules</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterInputsDF</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]:</span>
                <span class="c1"># Initialize variables to 0</span>
                <span class="n">tempStr</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot; = 0&quot;</span>  
                <span class="n">exec</span><span class="p">(</span><span class="n">tempStr</span><span class="p">,</span> <span class="n">boolodespace</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># Basal expression:</span>
            <span class="c1"># Execute the rule to figure out</span>
            <span class="c1"># the value of alpha_0 or omega_0</span>
            <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;booleval = &#39;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rule&#39;</span><span class="p">],</span> <span class="n">boolodespace</span><span class="p">)</span>         
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;alpha_&#39;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Gene&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">boolodespace</span><span class="p">[</span><span class="s1">&#39;booleval&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;omega_&#39;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Gene&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">heavisideThreshold</span><span class="p">(</span><span class="n">boolodespace</span><span class="p">[</span><span class="s1">&#39;booleval&#39;</span><span class="p">])</span>
        <span class="c1"># End initialization</span>

        <span class="c1"># Assign values to logic parameters, and construct expressions</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1">## Parse Boolean rule to get list of regulators</span>
            <span class="n">allreg</span><span class="p">,</span> <span class="n">regSpecies</span><span class="p">,</span> <span class="n">regInputs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getRegulatorsInRule</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rule&#39;</span><span class="p">],</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>

            <span class="c1"># Basal expression term</span>
            <span class="n">currgene</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Gene&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;( alpha_&#39;</span> <span class="o">+</span> <span class="n">currgene</span>
                <span class="n">den</span> <span class="o">=</span> <span class="s1">&#39;( 1&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
               <span class="n">exponent</span> <span class="o">=</span> <span class="s1">&#39;- sigmaH_&#39;</span> <span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span><span class="s1">&#39;*( omega_&#39;</span> <span class="o">+</span> <span class="n">currgene</span>

            <span class="c1"># Loop over combinations of regulators        </span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">allreg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">combinationOfRegulators</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">allreg</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">regulatorExpression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createRegulatoryTerms</span><span class="p">(</span><span class="n">currgene</span><span class="p">,</span> <span class="n">combinationOfRegulators</span><span class="p">,</span>
                                                                      <span class="n">regSpecies</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
                        <span class="c1"># Create Numerator and Denominator</span>
                        <span class="n">den</span> <span class="o">+=</span> <span class="s1">&#39; +&#39;</span> <span class="o">+</span>  <span class="n">regulatorExpression</span>
                        <span class="n">num</span> <span class="o">+=</span> <span class="s1">&#39; + a_&#39;</span> <span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinationOfRegulators</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">regulatorExpression</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
                        <span class="n">exponent</span> <span class="o">+=</span> <span class="s1">&#39; + w_&#39;</span> <span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinationOfRegulators</span><span class="p">))</span> <span class="o">+</span><span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">regulatorExpression</span>
    
                    <span class="c1"># evaluate rule to assign values to parameters</span>
                    <span class="c1">##################################################</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">withRules</span><span class="p">:</span>                 <span class="c1">#</span>
                        <span class="n">exec</span><span class="p">(</span><span class="n">node</span> <span class="o">+</span> <span class="s1">&#39; = 0&#39;</span><span class="p">,</span> <span class="n">boolodespace</span><span class="p">)</span>  <span class="c1">#                        </span>
                    <span class="c1"># Set each regulator to ON, evaluate rule. we are looping</span>
                    <span class="c1"># over all such combinations of regulators</span>
                    <span class="k">for</span> <span class="n">geneInList</span> <span class="ow">in</span> <span class="n">combinationOfRegulators</span><span class="p">:</span>     <span class="c1">#</span>
                        <span class="n">exec</span><span class="p">(</span><span class="n">geneInList</span> <span class="o">+</span> <span class="s1">&#39; = 1&#39;</span><span class="p">,</span> <span class="n">boolodespace</span><span class="p">)</span>    <span class="c1">#</span>
                                                                   <span class="c1">#</span>
                    <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;boolval = &#39;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rule&#39;</span><span class="p">],</span> <span class="n">boolodespace</span><span class="p">)</span> <span class="c1">#</span>
                    <span class="c1">##################################################</span>
    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;a_&#39;</span> <span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinationOfRegulators</span><span class="p">))]</span> <span class="o">=</span> \
                            <span class="nb">int</span><span class="p">(</span><span class="n">boolodespace</span><span class="p">[</span><span class="s1">&#39;boolval&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;w_&#39;</span> <span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinationOfRegulators</span><span class="p">))]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">kineticParameterDefaults</span><span class="p">[</span><span class="s1">&#39;heavisideOmega&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">utils</span><span class="o">.</span><span class="n">heavisideThreshold</span><span class="p">(</span><span class="n">boolodespace</span><span class="p">[</span><span class="s1">&#39;boolval&#39;</span><span class="p">])</span>                    

            <span class="c1"># Close expressions</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hill&#39;</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="s1">&#39; )&#39;</span>
                <span class="n">den</span> <span class="o">+=</span> <span class="s1">&#39; )&#39;</span>
                <span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">den</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;modeltype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;heaviside&#39;</span><span class="p">:</span>
                <span class="c1"># In the case of heaviside expressions, to prevent</span>
                <span class="c1"># numerical blowup, we trucate the magnitude of the</span>
                <span class="c1"># regulatory terms</span>
                <span class="n">exponent</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
                <span class="n">maxexp</span> <span class="o">=</span> <span class="s1">&#39;10.&#39;</span> <span class="c1"># &#39;100&#39;</span>
                <span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;(1./(1. + np.exp(np.sign(&#39;</span><span class="o">+</span><span class="n">exponent</span><span class="o">+</span><span class="s1">&#39;)*min(&#39;</span> <span class="o">+</span><span class="n">maxexp</span> <span class="o">+</span><span class="s1">&#39;,abs(&#39;</span> <span class="o">+</span> <span class="n">exponent</span><span class="o">+</span> <span class="s1">&#39;)))))&#39;</span>
            
            <span class="k">if</span> <span class="n">currgene</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteinlist</span><span class="p">:</span>
                <span class="n">Production</span> <span class="o">=</span>  <span class="n">f</span>
                <span class="n">Degradation</span> <span class="o">=</span> <span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">currgene</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="p">[</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">currgene</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;signalingtimescale*(y_max*&#39;</span> <span class="o">+</span> <span class="n">Production</span> \
                                           <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">Degradation</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">Production</span> <span class="o">=</span> <span class="s1">&#39;m_&#39;</span><span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">f</span>
                <span class="n">Degradation</span> <span class="o">=</span> <span class="s1">&#39;l_x_&#39;</span>  <span class="o">+</span> <span class="n">currgene</span> <span class="o">+</span> <span class="s1">&#39;*x_&#39;</span> <span class="o">+</span> <span class="n">currgene</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="p">[</span><span class="s1">&#39;x_&#39;</span> <span class="o">+</span> <span class="n">currgene</span><span class="p">]</span> <span class="o">=</span>  <span class="n">Production</span> \
                                           <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">Degradation</span>
                <span class="c1"># Create the corresponding translated protein equation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span><span class="p">[</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">currgene</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;r_&#39;</span><span class="o">+</span><span class="n">currgene</span><span class="o">+</span><span class="s1">&#39;*&#39;</span><span class="o">+</span><span class="s1">&#39;x_&#39;</span> <span class="o">+</span><span class="n">currgene</span> <span class="o">+</span> <span class="s1">&#39;- l_p_&#39;</span><span class="o">+</span><span class="n">currgene</span><span class="o">+</span><span class="s1">&#39;*&#39;</span><span class="o">+</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">currgene</span>
                
        <span class="c1">##########################################################                                       </span>
            
        <span class="c1"># Initialize variables between 0 and 1, Doesn&#39;t matter.</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="p">))]</span>
        <span class="n">pvals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteinlist</span><span class="p">))]</span>    
        <span class="n">ics</span> <span class="o">=</span> <span class="p">{}</span>
    
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">xv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genelist</span><span class="p">,</span> <span class="n">xvals</span><span class="p">):</span>
            <span class="n">ics</span><span class="p">[</span><span class="s1">&#39;x_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">xv</span>
            <span class="n">ics</span><span class="p">[</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteinlist</span><span class="p">,</span> <span class="n">pvals</span><span class="p">):</span>
            <span class="n">ics</span><span class="p">[</span><span class="s1">&#39;p_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;varspecs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varspecs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;pars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;ics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ics</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">var</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;varspecs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parmapper</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">par</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;pars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span></div>

<div class="viewcode-block" id="GenerateModel.writeModelToFile"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.writeModelToFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeModelToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes model to file as a python function.</span>
<span class="sd">        The ODE model generated using generateModelDict() is defined as </span>
<span class="sd">        a python ODE function called Model(). Model() takes 3 arguments:</span>

<span class="sd">        1. The current model state vector Y</span>
<span class="sd">        2. The current time t</span>
<span class="sd">        3. A list of parameters pars</span>

<span class="sd">        The function returns a vector of time derivatives computed from the ODEs.</span>
<span class="sd">        Model() is written model.py in the directory of the current job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_ode_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;outprefix&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;model.py&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_ode_model</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#####################################################</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;import numpy as np</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# This file is created automatically</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;def Model(Y,t,pars):</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    # Parameters</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">par_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;pars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">par_names</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39; = pars[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">outstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    # Variables</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; = Y[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">outstr</span> <span class="o">+=</span> <span class="s1">&#39;d&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="n">vdef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;varspecs&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">vdef</span> <span class="o">=</span> <span class="n">vdef</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;**&#39;</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    d&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">varmapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span><span class="o">+</span><span class="n">vdef</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    dY = np.array([&#39;</span> <span class="o">+</span> <span class="n">outstr</span><span class="o">+</span> <span class="s1">&#39;])</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    return(dY)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#####################################################&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="GenerateModel.writeParametersToFile"><a class="viewcode-back" href="../../BoolODE.html#BoolODE.model_generator.GenerateModel.writeParametersToFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeParametersToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes dictionary of parameters to file. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;outprefix&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/parameters.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Automatically generated by BoolODE</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ModelSpec</span><span class="p">[</span><span class="s1">&#39;pars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>    </div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Aditya Pratapa

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>